<template name="neworder">
  <form id="neworder">
    <h2>
      New order
      {{> whatisthis section="new-order"}}
    </h2>
    <table>
      <tbody>
        <tr>
          <th>
            Order type
          </th>
          <td>
            <div class="radio">
              <label><input type="radio" value="buy" {{b "group: type"}}> Buy {{baseCurrency}}</label>
              <label><input type="radio" value="sell" {{b "group: type"}}> Sell {{baseCurrency}}</label>
            </div>
          </td>
        </tr>
        <tr>
          <th>
            {{fancyType}}
          </th>
          <td>
            <div class="radio">
              {{#each token in allTokens}}
                {{#unless equals token._id baseCurrency}}
                  <label><input type="radio" value={{token._id}} {{b "group: currency"}}> {{token._id}}</label>
                {{/unless}}
              {{/each}}
            </div>
          </td>
        </tr>
        <tr>
          <th>
            {{fancyType}} Price (in {{currency}})
          </th>
          <td>
            <input type="number" class="input" step="any" min="0" {{b "value: price, change: calcTotal"}}>
          </td>
        </tr>
        <tr>
          <th>
            Amount (in {{baseCurrency}})
          </th>
          <td>
            <input type="number" class="input" step="any" min="0" {{b "value: amount, change: calcTotal, attr: { max: maxAmount }"}}>
          </td>
        </tr>
        <tr>
          <th>
            Total (in {{currency}})
          </th>
          <td>
            <input type="number" class="input" step="any" min="0" {{b "value: total, change: calcAmount, attr: { max: maxTotal }"}}>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <th>
          </th>
          <td>
            <button class="btn btn-default" data-toggle="modal" data-target="#newOrderModal" {{b "enable: canSubmit, click: preventDefault"}}>Submit order</button>
          </td>
        </tr>
        {{#unless equals lastError ''}}
          <tr>
            <td colspan="2">
              {{lastError}}
            </td>
          </tr>
        {{/unless}}
      </tfoot>
    </table>
  </form>

  <div class="modal fade" id="newOrderModal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Confirmation</h4>
        </div>
        <div class="modal-body">
          <table>
            <tbody>
              <tr>
                <th>Type</th>
                <th>{{type}}</th>
              </tr>
              <tr>
                <th>Price</th>
                <td>{{formatBalance (toWei price)}} {{currency}}</td>
              </tr>
              <tr>
                <th>Volume</th>
                <td>{{formatBalance (toWei amount)}} MKR</td>
              </tr>
              <tr>
                <th>Total</th>
                <td>{{formatBalance (toWei total)}} {{currency}}</td>
              </tr>
            </tbody>
          </table>
          <hr>
          <span class="text-danger">
            <b>Warning!</b>
            {{#if equals type 'buy'}}
              This action will remove {{formatBalance (toWei total)}} {{currency}} from your token balance and allowance.
            {{else}}
              This action will remove {{formatBalance (toWei amount)}} MKR from your token balance and allowance.
            {{/if}}
          </span>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" {{b "enable: canSubmit, click: submit"}}>Placer order</button>
        </div>
      </div>
    </div>
  </div>
</template>
